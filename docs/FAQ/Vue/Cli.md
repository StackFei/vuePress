# æ‰‹æ“ä¸€ä¸ªå±äºè‡ªå·±çš„Vue-Cli

> å‰ç«¯ä¸–ç•Œï¼Œæ¡†æ¶æ¨ªè¡Œã€‚å„ç§åŸºäºè„šæ‰‹æ¶çš„å·¥ç¨‹åŒ–å¼€å‘ï¼Œå¤§è¡Œå…¶é“ã€‚ä»¥å‰é¢è¯•ï¼Œä¸ä¼šæ¡†æ¶ç®—å¾—ä¸Šçš„è€»è¾±ã€‚ç°å¦‚ä»Šï¼Œä¸ä¼šè„šæ‰‹æ¶ï¼Œä¹Ÿæ€»æ„Ÿè§‰ç¼ºç‚¹å•¥ã€‚
è¾ƒä¸ºæˆç†Ÿçš„è„šæ‰‹æ¶æ¯”å¦‚Vueçš„ `Vue-Cli`, Reactçš„ `create-react-app`, ReactNativeçš„ `react-native-cli` ï¼Œè¿™äº›ç®—çš„ä¸Šæ˜¯ä¸šç•Œè¾ƒä¸ºæˆç†Ÿçš„è„šæ‰‹æ¶

## å‰è¨€
ä»Šå¤©å’±ä»¬å°±å°è¯•æ‰‹æ“ä¸€ä¸ªè‡ªå·±çš„ä¹ä¸ç‰ˆcliï¼Œç®—çš„ä¸Šæ˜¯ä¸€ä¸ªå°æŠ€å·§å§ã€‚æ¯æ¬¡åªçŸ¥é“ç”¨å…¶ä»–çš„è„šæ‰‹æ¶ï¼Œè¿è¡Œï¼Œç„¶åå°±èƒ½è·‘é¡¹ç›®ï¼Œå’±ä¹Ÿä¸çŸ¥é“å†…éƒ¨å‘ç”Ÿäº†å•¥ã€‚
å‰ç½®çŸ¥è¯†ï¼Œå¾—æ‡‚ä¸€ç‚¹ `Node`, `shell` å‘½ä»¤ï¼Œä¸ç„¶ä¹ŸæŒºæ¨¡ç³Šçš„ã€‚

## åˆå§‹åŒ–
åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ç»“æ„å…ˆã€‚æ¥ä¸‹æ¥é…ç½® `package.json` é…ç½®æ–‡ä»¶ã€‚
```javascript
â”€â”€ myCli
   â”œâ”€â”€ bin// å­˜æ”¾é…ç½®æ–‡ä»¶    
   |    â”œâ”€â”€ my 
   |    â””â”€â”€ package.json 
   â””â”€â”€ package.json    // åˆå§‹åŒ–çš„é…ç½®æ–‡ä»¶

// package.json
{
  "main": "index.js",
  "bin": {
      "my": "./bin/my"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}

// my
#!/usr/bin/env node

console.log('å±äºè‡ªå·±çš„è„šæ‰‹æ¶')
```

## åŸºæœ¬é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯æœ‰è®²ç©¶çš„ï¼Œé…ç½® `bin` ç›®å½•æ–‡ä»¶å¤¹,è‡ªå®šä¹‰ä¸€æ¡å‘½ä»¤ `my` ï¼Œæ‰¾åˆ° `bin`ç›®å½•ä¸‹çš„æ–‡ä»¶ `my`, å½“ç„¶è¿™äº›éƒ½æ˜¯æŒ‡ä»¤å·²ç»æ–‡ä»¶åéƒ½æ˜¯è‡ªå·±è‡ªå®šä¹‰çš„ï¼Œç»å¯¹ï¼Œç»å¯¹ï¼Œç»å¯¹ä¸èƒ½å†é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ³¨é‡Š!
å°±ç»ªä¹‹åï¼Œéœ€è¦å°†è‡ªå·±çš„åŒ… `link` åˆ°å…¨å±€ç¯å¢ƒä¸­ï¼Œ ä½¿ç”¨ `npm link` ä¼šå°†å‘½ä»¤å‘å¸ƒåˆ°å…¨å±€ä½œç”¨åŸŸï¼ŒMac æ— æ³•linkçš„è¯ ä½¿ç”¨ `sudo`ï¼Œä¸€åˆ‡å°±ç»ªï¼Œå›åˆ°å‘½ä»¤è¡Œæ‰§è¡Œã€‚

![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue1.gif)

æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ˜¾è‘—çš„ï¼Œæœ‰æ²¡æœ‰ä¸€ç§è‡ªè±ªæ„Ÿï¼Œåæ­£å½“æ—¶å°ç¼–æœ‰ä¸€è‚¡æ…¢æ…¢çš„è‡ªè±ªæ„Ÿã€‚å½“ç„¶å¦‚æœä½ ä¹Ÿæƒ³ç»™å…¶ä»–äººä½¿ç”¨ï¼Œåœ¨æ‰§è¡Œ `npm login` ä¸Šä¼ åˆ°å…¨å±€npmï¼Œç„¶ååˆ«äººæ‰§è¡Œ `npm install -g xxxx` ï¼Œå°±å¯ä»¥ä¸‹è½½ä½ è®¾ç½®çš„åŒ…æ¥ä½¿ç”¨ã€‚
ä½†æ˜¯ä»…ä»…åªæ˜¯ä¸€æ¡å‘½ä»¤ï¼Œæ€»æ„Ÿè§‰ç¼ºç‚¹å•¥ï¼Œå¾—æ¥ç‚¹å®ç”¨çš„ã€‚æ˜¯å¹²å°±å¹²ã€‚å›åˆ°è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚
```javascript
// my
const program = require('commander'); 
program.version("6.6.6","-v, --version")
program.command("init","ğŸ”¥")
program.parse(process.argv)
```
ç¨ä½œè§£é‡Šï¼Œ`commander` å±äºæ²Ÿé€šshellå‘½ä»¤çš„åŒ…ï¼Œ`version` ç‰ˆæœ¬ä¿¡æ¯ï¼Œ`command` ä¾¿æ˜¯å’Œç”¨æˆ·äº¤äº’çš„ä¿¡æ¯ï¼Œ`parse` å°†å‘½ä»¤pushåˆ°è¿›ç¨‹ä¸­,è¿™äº›éƒ½æ˜¯å›ºå®šçš„å†™æ³•ï¼Œä¸å¤ªç†è§£çš„å¾—å»`npm`å¥½å¥½ç ”ç©¶ä¸€ä¸‹äº†ã€‚çœ‹æ•ˆæœã€‚

![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue2.gif)

## ç¾åŒ–é¡¹ç›®ç•Œé¢

æ•ˆæœå‡ºæ¥äº†ï¼Œæœ‰ç‚¹ä¸œè¥¿ï¼Œä½†ä¼˜ç§€çš„å‰ç«¯ä¸æ­¢äºæ­¤ï¼Œæœ‰ç‚¹å—‘é¦‹ï¼Œä¸Šä¸äº†ç‰Œé¢ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œå’±ç»™ä»–ç¾åŒ–ç¾åŒ–å‘—ã€‚ç¨ä½œæ”¹é€ ã€‚
```javascript
// æ™®é€šå­—
const Printer = require('@darkobits/lolcatjs')
program.version(Printer.default.fromString("æ‰“é€ æœ€å¼ºcli"),"-v, --version")

//èŠ±é‡Œèƒ¡å“¨
const my = [
"              **   **" ,
" **********  //** ** " ,
"//**//**//**  //***  " ,
" /** /** /**   /**  "  , 
" /** /** /**   **    " ,
" *** /** /**  **   "   ,
"///  //  //  // "      ,
].join("\n");
program.version(Printer.default.fromString(my),"-v, --version")
```
`@darkobits/lolcatjs`è´Ÿè´£å°†è¾“å‡ºçš„ç»ˆç«¯å‘½ä»¤å˜æˆæ¸å˜è‰²ï¼Œå“ï¼Œå…‰æ˜¾ç¤ºå­—ï¼Œå¯ä¸æ˜¯å’±çš„é£æ ¼ï¼Œè¦æ¥å°±è¦æ¥ç‚¹éªšæ“ä½œã€‚

![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue3.gif)
![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue4.gif)

## ç»ˆç«¯äº¤äº’åé¦ˆ
è„šæ‰‹æ¶åªæœ‰è¿™ç§èŠ±é‡Œèƒ¡å“¨çš„å½“ç„¶ä¹Ÿä¸è¡Œï¼Œå¾—å’Œç”¨æˆ·äº¤äº’å•Šï¼Œæ¥ä¸‹æ¥å°±æ˜¯å’Œç”¨æˆ·äº¤äº’ï¼Œç”¨æˆ·è¾“å…¥æŒ‡å®šä¿¡æ¯ï¼Œè¿™è¾¹ä½œå‡ºåé¦ˆã€‚å›åˆ°é…ç½®æ–‡ä»¶ã€‚
```javascript
// ç»ˆç«¯ä¸ç”¨æˆ·å¯¹è¯
const chalk = require('chalk');
// å‰ç«¯shell
const shelljs = require('shelljs');
const binParams = {
    init(){
        console.log('ğŸŒ')
    }
}
program
    .usage("[cmd] <options>")
    .arguments("<cmd> [env]")
    .action((cmd , otherParams)=> {
        const handler = binParams[cmd]
        if(typeof handler === "undefined"){
            console.log(`${chalk.yellow("ï¸ âš ï¸ ğŸš§ ")}sorry [${chalk.red(cmd)}] It's not defined ğŸ‘½`);
            process.exit(1)
        }else{
            handler(otherParams)
        }
    })
```
`shelljs` ä¸“æ³¨äºä¸ç»ˆç«¯äº¤äº’, `chalk` æ¥å—ç”¨æˆ·çš„æŒ‡ä»¤ï¼Œå¹¶è¿”å›æŒ‡ä»¤ä¿¡æ¯,`binParams` å­˜å‚¨æ‰€æœ‰çš„æŒ‡ä»¤ä¿¡æ¯ï¼Œå¯¹è¯æ—¶ä¹Ÿè¦å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œç”¨æˆ·é€€å‡ºæ—¶ 
å¾—ä½¿ç”¨`process.exit(1)` å®‰å…¨é€€å‡ºï¼Œæ²¡æœ‰ç›¸å…³æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥å‘ç”¨æˆ·è¿”å›æ¸©é¦¨æç¤ºä¿¡æ¯ã€‚å½“ç„¶é€”ä¸­ä¼šå­˜åœ¨ä¸€äº›âš è­¦å‘Šï¼Œåç»­ä¹Ÿä¼šå¤„ç†æ‰ã€‚

![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue5.gif)

åŸºæœ¬çš„ç”¨æˆ·ç•Œé¢å·²ç»å¤„ç†å¥½äº†ï¼Œä½†è„šæ‰‹æ¶å­˜åœ¨çš„ç›®çš„å°±æ˜¯ä¸‹è½½é¡¹ç›®æ¶æ„ï¼Œç›®çš„æ˜¯ä¸‹è½½ï¼Œä¸‹è½½å‰å¾—é€‰æ‹©å„ç§ç¯å¢ƒã€çŠ¶æ€ã€ä»¥åŠä½¿ç”¨è¯­è¨€ã€‚æ£é¼“èµ·æ¥
```javascript
const inquirer = require('inquirer')
const binParams = {
    init(){
        inquirer
            .prompt([
                {
                    type: "text",
                    message: "è¯·é€‰æ‹©è¾“å…¥é¡¹ç›®åç§°",
                    name:"dirname"
                },
                {
                    type: "list",
                    message: "è¯·é€‰æ‹©éœ€è¦ä½¿ç”¨çš„è¯­è¨€",
                    choices: ["â¤JavaScript", "â¤TypeScript"],
                    name:"kind"
                }
            ])
            .then(answers => {
                // any wer
            })
    }
}
```
`inquirer`ä¸“é—¨å’Œç”¨æˆ·å¯¹è¯çš„èµ„æºåŒ…ï¼Œè¿™ç»“æ„çœ‹èµ·æ¥ä¸é™Œç”Ÿå§ï¼Œæ¯æ¬¡æ„å»ºé¡¹ç›®æ—¶ï¼Œè¿™éƒ½æ˜¯å¿…é€‰é¡¹ï¼Œä½†ç›®å‰ä¹Ÿåªæ˜¯ä¸€æ¬¡æ€§æ“ä½œï¼Œå¹¶ä¸èƒ½å®Œå…¨é€‰æ‹©ã€‚
è¿™äº›å…¶å®æ²¡å•¥å¥½çº ç»“çš„ï¼Œå…¨æ˜¯å›ºå®šçš„åŒ…ï¼Œå›ºå®šçš„ä½¿ç”¨æ–¹æ³•ã€‚å…ˆå‰çœ‹åˆ°çš„å‘½ä»¤è¡Œæœ‰ä¸€æ¡è­¦å‘ŠæŠ¥é”™ï¼Œå…¶å®åªæ˜¯è­¦å‘Šå‘½ä»¤ï¼Œå¦‚æœæœ‰å¼ºè¿«ç—‡å¯ä»¥å°†ä¹‹å‰å†™çš„ `program.command("init","ğŸ”¥");` æ³¨é‡Šæ‰å³å¯ã€‚ç„¶åé…åˆä¸Šä¸€äº›ç‰¹æ®Šå­—ç¬¦ä¼šæ˜¾å¾—æ›´åŠ äººæ€§åŒ–ã€‚`then` ä¸­ä¹Ÿæ˜¯ç”¨æˆ·è¾“å…¥åçš„æ‰€æœ‰åé¦ˆä¿¡æ¯

![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue6.gif)

é€‰æ‹©æ¨¡å—æ—¢ç„¶å¾—åˆ°äº†è§£å†³ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ä¸‹è½½æ¨¡å—ï¼Œä¸‹è½½ä¹‹å‰ï¼Œæˆ–è€…æ˜¯ä¸‹è½½ä¸­éƒ½å¾—ç»™ç”¨æˆ·æä¾›ä¸‹è½½ä½“æ„Ÿï¼Œåˆåˆ°äº†è£…åŒ…çš„æ—¶åˆ»ã€‚`ora` ä¸€ä¸ªç®€å•çš„ `loading` çŠ¶æ€ã€‚
```javascript
const ora = require('ora')
 ...
then(answers => {
    const _dirname = answers.dirname;
    if(_dirname){
        const spinner = ora("ğŸš€ æœ€å¼ºcliç©å‘½åŠ è½½ä¸­...");
        spinner.start(); 
    }
})
```
![å±äºè‡ªå·±çš„cli](../../.vuepress/public/Vue/img/vue7.gif)

çœ‹èµ·æ¥åƒé‚£ä¹ˆå›äº‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸‹è½½æ¨¡æ¿çš„æ—¶å€™ã€‚

## é…ç½®ä¸‹è½½æ¨¡æ¿
ç»ˆäºåˆ°äº†èƒ½ä¸‹è½½æ¨¡æ¿çš„æ—¶å€™ã€‚é¦–å…ˆä½ å¾—å‡†åˆ«ä¸€å¥—æ¨¡æ¿ `template`ï¼Œå…¶æ¬¡å¾—æœ‰ä¸€ä¸ªä¸‹è½½å·¥å…· `download` å½“ç„¶å¦‚æœå¤Ÿæ ¼å¯ä»¥è‡ªå·±å†™ä¸€å¥—ï¼Œè¿™é‡Œå°±éšä¾¿æ‰¾äº†ä¸€å¥—ä»£ç 
ç„¶åä¸‹è½½æ¨¡æ¿å¾—æœ‰ä¸€ä¸ªä¸‹è½½ç›®çš„åœ°è·¯å¾„ï¼Œæ­¤å¤„é»˜è®¤ç”¨ç¬¬ä¸‰æ–¹åŒ…`user-home` æ‰¾åˆ°ç”¨æˆ·çš„æ ¹ç›®å½•ï¼Œ`shelljs`æ­¤æ—¶çš„ä½œç”¨è‡³å…³é‡è¦ï¼Œå…¨é å®ƒæ‰èƒ½æ“ä½œåˆ°ç”¨æˆ·çš„ç›®å½•ã€‚
```javascript
const download = require('download');
const userHome = require('user-home');
const template = "direct:https://github.com/StackFei/Promises.git"
then(answers => {
    ...
    if(_dirname){
        ...
        ...
        const __project = `${userHome}/Desktop/${_dirname}`
        shelljs.cd(`${userHome}/Desktop/`);
        shelljs.rm('-rf',__project); 
        shelljs.mkdir(__dirname);
        download(template,__project,{clone:true}, err => {
            spinner.stop();
            //åç»­ä¸‹è½½æˆåŠŸçš„æ“ä½œ
        })
    }
})
```

ä¸å‡ºæ„å¤–ï¼Œä¸€ä¸ªå´­æ–°çš„å±äºè‡ªå·±çš„æ¨¡æ¿çš„cliå°±è¿™ä¹ˆæ¨ªç©ºå‡ºä¸–äº†ã€‚è¯´ç®€å•ä¸ç®€å•ï¼Œè¯´éš¾ä¸éš¾ã€‚å­¦ä¼šäº†ä¹Ÿç®—æ˜¯è‡ªå·±çš„ä¸€ä¸ªå°æŠ€å·§å§ã€‚

